<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Gentle Reset Workout</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" href="my-icon.png">

  <!-- PWA Support -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ffffff">

  <!-- Sound Preloads -->
  <link rel="preload" as="audio" href="https://actions.google.com/sounds/v1/alarms/beep_short.ogg">
  <link rel="preload" as="audio" href="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg">
  <link rel="preload" as="audio" href="https://actions.google.com/sounds/v1/human_voices/cheerful_fanfare.ogg">
  <link rel="preload" as="audio" href="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg">

  <style>
    /* ========== Original inline CSS preserved ========== */
    body {
      background: #fafafa;
      font-family: Arial, sans-serif;
      transition: background 0.3s, color 0.3s;
      color: #333;
      margin: 0;
    }
    .dark-mode {
      background: #121212 !important;
      color: #eee !important;
    }
    .container, section {
      max-width: 600px;
      margin: 0 auto;
      padding: 10px;
    }
    h1, h2, h3 {
      color: #2c3e50;
    }
    .dark-mode h1,
    .dark-mode h2,
    .dark-mode h3 {
      color: #ddd !important;
    }
    .container {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 8px #ccc;
      padding: 24px;
      margin-bottom: 24px;
    }
    .dark-mode .container {
      background: #222;
      box-shadow: 0 0 8px #222;
    }
    .workout {
      margin: 10px 0;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      position: relative;
      list-style: none;
      background: #f8f8f8;
    }
    .dark-mode .workout {
      background: #242424;
      border: 1px solid #444;
    }
    .workout span {
      font-weight: bold;
    }
    .timer-display {
      font-size: 1.5em;
      margin-top: 5px;
    }
    .progress-bar {
      background: #eee;
      height: 6px;
      width: 100%;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 4px;
    }
    .dark-mode .progress-bar {
      background: #333;
    }
    .progress-bar .progress {
      height: 100%;
      width: 0%;
      background: #4caf50;
      transition: width 1s linear;
    }
    .pause-resume, .skip-next, .prev-workout, .master-reset {
      margin-top: 5px;
      padding: 4px 12px;
      background: #f5f5f5;
      color: #333;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1em;
      margin-right: 5px;
      display: none;
    }
    .pause-resume:active, .skip-next:active, .prev-workout:active, .master-reset:active {
      background: #e0e0e0;
    }
    .master-reset {
      background: #ffecec;
      color: #c00;
      border: 1px solid #c99;
      margin: 24px auto 0 auto;
      display: block;
      width: 100%;
    }
    .dark-mode .master-reset {
      background: #3d1a1a;
      color: #ffb3b3;
      border: 1px solid #7d4444;
    }
    .tracker-table-wrapper {
      border: 2px solid #333;
      border-radius: 8px;
      overflow-x: auto;
      margin-bottom: 24px;
      background: #fff;
      padding: 16px;
      box-shadow: 0 0 4px #ddd;
      width: 100%;
    }
    .dark-mode .tracker-table-wrapper {
      background: #222;
      box-shadow: 0 0 4px #222;
      border: 2px solid #bbb;
    }
    table {
      width: 100%;
      min-width: 650px;
      border-collapse: collapse;
      background: #fff;
      table-layout: auto;
      margin-top: 10px;
      font-size: 1em;
    }
    .dark-mode table {
      background: #222;
      color: #eee;
    }
    th, td {
      border: 1px solid #888;
      padding: 8px 4px;
      text-align: center;
      word-break: break-word;
      transition: background 0.2s;
    }
    th {
      background: #f0f0f0;
      font-weight: bold;
    }
    .dark-mode th {
      background: #1e1e1e;
      color: #eee;
    }
    .check-cell {
      cursor: pointer;
      min-width: 26px;
      font-size: 1.2em;
      background: #f8f8f8;
    }
    .check-cell.checked {
      background-color: #c8facc;
      font-weight: bold;
    }
    .dark-mode .check-cell {
      background: #222;
      color: #eee;
    }
    .dark-mode .check-cell.checked {
      background-color: #2e7d32;
      color: #fff;
    }
    .toggle-dark {
      margin-bottom: 20px;
      padding: 10px 20px;
      font-size: 1em;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #888;
      background: #f5f5f5;
      color: #333;
      transition: background 0.3s, color 0.3s;
    }
    .dark-mode .toggle-dark {
      background: #222;
      color: #eee;
      border: 1px solid #bbb;
    }
    /* ========== End original styles ========== */
  </style>
</head>
<body>
  <button class="toggle-dark">Toggle Dark Mode</button>

  <!-- Tracker Table -->
  <section class="tracker-table-wrapper">
    <h2>Weekly Progress Tracker</h2>
    <p>Mark each session you complete with a ✓</p>
    <table>
      <thead>
        <tr>
          <th>Week</th>
          <th>Monday<br>Morning</th>
          <th>Monday<br>Evening</th>
          <th>Wednesday<br>Morning</th>
          <th>Wednesday<br>Evening</th>
          <th>Friday<br>Morning</th>
          <th>Friday<br>Evening</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Week 1</td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td></tr>
        <tr><td>Week 2</td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td></tr>
        <tr><td>Week 3</td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td></tr>
        <tr><td>Week 4</td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td><td class="check-cell"></td></tr>
      </tbody>
    </table>
  </section>

  <div class="container">
    <h1>Gentle Reset Workout Plan (2x5 Minutes Daily)</h1>
    <p>3 Days a Week • Morning & Evening • Total: 10 Minutes/Day</p>

    <!-- Day 1 (Monday) -->
    <div class="day">
      <h2>Day 1 (Monday)</h2>

      <h3>Morning Session:</h3>
      <ul>
        <li class="workout">
          <span>March in Place (Gentle Warm-Up)</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Arm Circles + Shoulder Rolls</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Step Jacks or Side Steps</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>High Knees (march if needed)</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Stretch (Hamstrings, Quads, Shoulders)</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
      </ul>

      <h3>Evening Session:</h3>
      <ul>
        <li class="workout">
          <span>Light Jog or Walk in Place</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Squat to Reach (or sit to stand)</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Arm Swings + Cross Body Punches</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Standing Side Crunch</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout">
          <span>Cool Down Stretch</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button>
          <button class="pause-resume skip-next">Go to Next</button>
          <button class="pause-resume prev-workout">Previous</button>
        </li>
      </ul>
    </div>

    <!-- Day 2 (Wednesday) -->
    <div class="day">
      <h2>Day 2 (Wednesday)</h2>

      <h3>Morning Session:</h3>
      <ul>
        <li class="workout">
          <span>March in Place (Gentle Warm-Up)</span>
          <div class="timer-display">01:00</div>
          <div class="progress-bar"><div class="progress"></div></div>
          <button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button>
        </li>
        <li class="workout"><span>Side Steps or Step Jacks</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>High Knees or Knee Lifts</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Shoulder Rolls + Arm Swings</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Stretch (Hamstrings, Back, Arms)</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
      </ul>

      <h3>Evening Session:</h3>
      <ul>
        <li class="workout"><span>Walk in Place + Deep Breathing</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Seated or Standing Squats</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Step Touch with Arm Swings</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Wall Push-ups or Air Punches</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Gentle Cool Down Stretch</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
      </ul>
    </div>

    <!-- Day 3 (Friday) -->
    <div class="day">
      <h2>Day 3 (Friday)</h2>

      <h3>Morning Session:</h3>
      <ul>
        <li class="workout"><span>March in Place (Gentle Warm-Up)</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Step Backs or Light Lunges</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Arm Circles + Shoulder Rolls</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>High Knees (march if needed)</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Stretch (Neck, Arms, Legs)</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
      </ul>

      <h3>Evening Session:</h3>
      <ul>
        <li class="workout"><span>Walk in Place</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Gentle Squats or Sit to Stand</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Step Side to Side</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Arm Raises with Breathing</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
        <li class="workout"><span>Full Body Stretch</span><div class="timer-display">01:00</div><div class="progress-bar"><div class="progress"></div></div><button class="pause-resume">Pause</button><button class="pause-resume skip-next">Go to Next</button><button class="pause-resume prev-workout">Previous</button></li>
      </ul>
    </div>

    <button class="master-reset">Master Reset Timer</button>
  </div>

  <!-- Inline JS: keeps original functions + new features as requested -->
  <script>
    // ------------------- App State -------------------
    let activeWorkout = null;
    let timerInterval = null;
    let countdownInterval = null;
    let remainingTime = 60;
    let isPaused = false;

    // Sounds
    const beep = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');
    const startBoing = new Audio('https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg');
    const finishFanfare = new Audio('https://actions.google.com/sounds/v1/human_voices/cheerful_fanfare.ogg');

    // Motivation messages (shown at session start)
    const motivationalMessages = [
      "You've got this!",
      "Let's start strong!",
      "Breathe, steady, go!",
      "Nice and steady — you can do it!",
      "Small steps, big wins!"
    ];

    // ------------------- Utility fns -------------------
    function getAllWorkouts() {
      return Array.from(document.querySelectorAll('.workout'));
    }

    function formatTime(s) {
      return `00:${String(s).padStart(2, '0')}`;
    }

    function updateProgress(bar) {
      if (!bar) return;
      bar.style.width = `${((60 - remainingTime) / 60) * 100}%`;
    }

    // ------------------- Tracker persistence -------------------
    const trackerCells = Array.from(document.querySelectorAll('.check-cell'));
    function saveCheckCellData() {
      const data = trackerCells.map(cell => cell.textContent === '\u2713');
      localStorage.setItem('checkCellData', JSON.stringify(data));
    }
    function loadCheckCellData() {
      const raw = localStorage.getItem('checkCellData');
      if (!raw) return;
      try {
        const data = JSON.parse(raw);
        trackerCells.forEach((cell, i) => {
          if (data[i]) {
            cell.textContent = '\u2713';
            cell.classList.add('checked');
          } else {
            cell.textContent = '';
            cell.classList.remove('checked');
          }
        });
      } catch (e) { /* ignore */ }
    }
    trackerCells.forEach(cell => {
      cell.addEventListener('click', () => {
        const checked = cell.textContent === '\u2713';
        cell.textContent = checked ? '' : '\u2713';
        cell.classList.toggle('checked', !checked);
        saveCheckCellData();
      });
    });

    // ------------------- Dark mode persistence -------------------
    function saveDarkMode(isDark) {
      localStorage.setItem('darkMode', isDark ? 'true' : 'false');
    }
    function loadDarkMode() {
      return localStorage.getItem('darkMode') === 'true';
    }
    // Attach toggle
    const toggleButton = document.querySelector('.toggle-dark');
    toggleButton.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      saveDarkMode(document.body.classList.contains('dark-mode'));
    });
    if (loadDarkMode()) document.body.classList.add('dark-mode');

    // ------------------- Workout session helpers -------------------
    function isLastWorkoutOfSession(workoutElement, session = 'morning') {
      const dayDiv = workoutElement.closest('.day');
      if (!dayDiv) return false;
      const h3s = Array.from(dayDiv.querySelectorAll('h3'));
      const h3 = h3s.find(h => new RegExp(session, 'i').test(h.textContent));
      const ul = h3 ? h3.nextElementSibling : null;
      if (!ul) return false;
      const items = Array.from(ul.querySelectorAll('.workout'));
      return items.length && workoutElement === items[items.length - 1];
    }

    function isFirstWorkoutOfSession(workoutElement) {
      const dayDiv = workoutElement.closest('.day');
      if (!dayDiv) return false;
      // Find the session (morning/evening) that contains this workout
      const h3s = Array.from(dayDiv.querySelectorAll('h3'));
      for (const h3 of h3s) {
        const ul = h3.nextElementSibling;
        if (!ul) continue;
        const items = Array.from(ul.querySelectorAll('.workout'));
        if (items.includes(workoutElement)) {
          return workoutElement === items[0];
        }
      }
      return false;
    }

    function isLastWorkoutOfDay(workoutElement) {
      return isLastWorkoutOfSession(workoutElement, 'evening');
    }

    // ------------------- Save/Load in-progress workout -------------------
    function saveProgress(index, remaining, paused) {
      localStorage.setItem('workoutProgress', JSON.stringify({
        index, remaining, paused, ts: Date.now()
      }));
    }
    function loadProgress() {
      const raw = localStorage.getItem('workoutProgress');
      if (!raw) return null;
      try { return JSON.parse(raw); } catch(e) { return null; }
    }
    function clearProgress() {
      localStorage.removeItem('workoutProgress');
    }

    // ------------------- Mark completed -------------------
    function markCompleted(workoutEl) {
      if (!workoutEl) return;
      if (workoutEl.querySelector('.complete-badge')) return;
      const badge = document.createElement('span');
      badge.textContent = ' ✅';
      badge.className = 'complete-badge';
      badge.style.marginLeft = '8px';
      workoutEl.querySelector('.timer-display')?.appendChild(badge);
    }

    // ------------------- Countdown (before each workout) -------------------
    function startCountdownForWorkout(workoutEl, onStart) {
      // Clear any existing countdown
      if (countdownInterval) {
        clearInterval(countdownInterval);
        countdownInterval = null;
      }
      let count = 3;
      const timerEl = workoutEl.querySelector('.timer-display');
      const originalText = timerEl ? timerEl.textContent : null;
      if (timerEl) timerEl.textContent = `Starting in: ${count}`;
      // Play beep each count (user-initiated so audio should be allowed)
      countdownInterval = setInterval(() => {
        count--;
        try { beep.currentTime = 0; beep.play().catch(()=>{}); } catch(e) {}
        if (timerEl) timerEl.textContent = count > 0 ? `Starting in: ${count}` : 'GO!';
        if (count <= 0) {
          clearInterval(countdownInterval);
          countdownInterval = null;
          try { startBoing.currentTime = 0; startBoing.play().catch(()=>{}); } catch(e){}
          // small delay so 'GO!' displays
          setTimeout(() => {
            if (timerEl) timerEl.textContent = formatTime(remainingTime);
            onStart();
          }, 600);
        }
      }, 1000);
    }

    // ------------------- Core workout start logic -------------------
    function startWorkout(el, restore=false) {
      // Stop any running timers
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }

      const all = getAllWorkouts();
      const idx = all.indexOf(el);
      if (idx === -1) return;

      activeWorkout = el;
      remainingTime = restore && loadProgress()?.remaining ? loadProgress().remaining : 60;
      isPaused = restore && loadProgress()?.paused ? loadProgress().paused : false;

      const timerEl = el.querySelector('.timer-display');
      const progressEl = el.querySelector('.progress');
      const pauseBtn = el.querySelector('.pause-resume:not(.skip-next):not(.prev-workout)');
      const skipBtn = el.querySelector('.pause-resume.skip-next');
      const prevBtn = el.querySelector('.pause-resume.prev-workout');

      // hide controls for other workouts
      all.forEach(w => {
        if (w !== el) {
          w.querySelectorAll('.pause-resume').forEach(b => b.style.display = 'none');
        }
      });

      // If this workout is the first of its session, show a motivational message
      if (isFirstWorkoutOfSession(el)) {
        const msg = motivationalMessages[Math.floor(Math.random() * motivationalMessages.length)];
        try { alert(msg); } catch(e) {}
      }

      // Set initial UI state
      if (timerEl) timerEl.textContent = formatTime(remainingTime);
      if (progressEl) progressEl.style.width = `${((60 - remainingTime) / 60) * 100}%`;

      // show pause/resume
      if (pauseBtn) {
        pauseBtn.style.display = 'inline-block';
        pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
        pauseBtn.onclick = (ev) => {
          ev.stopPropagation();
          isPaused = !isPaused;
          pauseBtn.textContent = isPaused ? 'Resume' : 'Pause';
          // Save progress
          saveProgress(idx, remainingTime, isPaused);
        };
      }

      // prev button
      if (prevBtn) {
        prevBtn.style.display = (idx === 0) ? 'none' : 'inline-block';
        prevBtn.textContent = 'Previous';
        prevBtn.onclick = (ev) => {
          ev.stopPropagation();
          // Clear saved progress and start previous
          clearProgress();
          if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
          startWorkout(all[idx - 1]);
        };
      }

      // skip/next button
      if (skipBtn) {
        skipBtn.style.display = (idx + 1 < all.length) ? 'inline-block' : 'none';
        skipBtn.textContent = 'Go to Next';
        skipBtn.onclick = (ev) => {
          ev.stopPropagation();
          if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
          clearProgress();
          if (idx + 1 < all.length) startWorkout(all[idx + 1]);
        };
      }

      // Start countdown then timer
      startCountdownForWorkout(el, () => {
        // Save progress (index)
        saveProgress(idx, remainingTime, isPaused);

        timerInterval = setInterval(() => {
          if (!isPaused) {
            remainingTime--;
            if (timerEl) timerEl.textContent = formatTime(remainingTime);
            if (progressEl) updateProgress(progressEl);
            saveProgress(idx, remainingTime, isPaused);

            // occasional motivational console messages (won't interrupt)
            // (optional) every 15s
            // if (remainingTime % 15 === 0) console.log("Keep going!");

            if (remainingTime <= 0) {
              clearInterval(timerInterval);
              timerInterval = null;
              try { finishFanfare.currentTime = 0; finishFanfare.play().catch(()=>{}); } catch(e){}

              // Mark completed visually
              markCompleted(el);

              // If this is the last workout of the morning session, STOP (do NOT auto-advance).
              if (isLastWorkoutOfSession(el, 'morning')) {
                try { alert("Congrats — you finished the morning session! See you this evening."); } catch(e){}
                clearProgress();
                // hide buttons & set Done
                cleanupAfterFinish(el);
                return;
              }

              // If this is the last workout of the day (evening), stop and show summary
              if (isLastWorkoutOfDay(el)) {
                try { alert("🎉 You completed all workouts today! Great work — see you tomorrow!"); } catch(e){}
                clearProgress();
                cleanupAfterFinish(el);
                return;
              }

              // Otherwise, move to the next workout in the full list
              const nextIdx = idx + 1;
              if (nextIdx < all.length) {
                startWorkout(all[nextIdx]);
              } else {
                // end
                clearProgress();
              }
            }
          }
        }, 1000);
      });
    }

    function cleanupAfterFinish(el) {
      // Hide controls, set timer text to Done, fill progress
      const pauseBtn = el.querySelector('.pause-resume:not(.skip-next):not(.prev-workout)');
      const skipBtn = el.querySelector('.pause-resume.skip-next');
      const prevBtn = el.querySelector('.pause-resume.prev-workout');
      const timerEl = el.querySelector('.timer-display');
      const progressEl = el.querySelector('.progress');

      if (pauseBtn) pauseBtn.style.display = 'none';
      if (skipBtn) skipBtn.style.display = 'none';
      if (prevBtn) prevBtn.style.display = 'none';
      if (timerEl) timerEl.textContent = 'Done';
      if (progressEl) progressEl.style.width = '100%';
      activeWorkout = null;
      isPaused = false;
    }

    // ------------------- Master Reset -------------------
    function masterReset() {
      if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
      if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
      getAllWorkouts().forEach(w => {
        const timerEl = w.querySelector('.timer-display');
        const progressEl = w.querySelector('.progress');
        const badge = w.querySelector('.complete-badge');
        if (badge) badge.remove();
        if (timerEl) timerEl.textContent = '01:00';
        if (progressEl) progressEl.style.width = '0%';
        w.querySelectorAll('.pause-resume').forEach(b => b.style.display = 'none');
      });
      trackerCells.forEach(cell => { cell.textContent = ''; cell.classList.remove('checked'); });
      clearProgress();
      activeWorkout = null;
      isPaused = false;
    }
    document.querySelector('.master-reset').addEventListener('click', masterReset);

    // ------------------- Resume prompt on load -------------------
    document.addEventListener('DOMContentLoaded', () => {
      // Attach click handlers to workouts
      getAllWorkouts().forEach(w => {
        w.addEventListener('click', (ev) => {
          // If clicking a control button, ignore
          if (ev.target && ev.target.classList && ev.target.classList.contains('pause-resume')) return;
          // Clear any saved progress when user explicitly starts a workout (fresh)
          // But we offer resume below if there's saved progress
          startWorkout(w);
        });
      });

      // load saved tracker + dark mode
      loadCheckCellData();
      if (loadDarkMode()) document.body.classList.add('dark-mode');

      // If there's saved progress, offer to resume
      const saved = loadProgress();
      const all = getAllWorkouts();
      if (saved && typeof saved.index === 'number' && saved.index < all.length) {
        const ageMs = Date.now() - (saved.ts || 0);
        // only offer if not stale (>24h considered stale)
        if (ageMs < 24 * 60 * 60 * 1000) {
          const resume = confirm("You have an unfinished workout. Continue where you left off?");
          if (resume) {
            startWorkout(all[saved.index], true);
          } else {
            clearProgress();
          }
        } else clearProgress();
      }
    });

    // ------------------- Service Worker registration -------------------
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('✅ Service Worker registered'))
      .catch(err => console.error('❌ SW registration failed:', err));
    }

    // ================= End of inline script =================
  </script>
</body>
</html>
